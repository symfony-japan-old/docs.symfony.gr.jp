
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>サービスコンテナ | Symfony2日本語ドキュメント</title>
    <link rel="stylesheet" href="../static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../static/configurationblock.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
      <script type="text/javascript" src="../static/js/jquery.corner.js"></script>
      <script type="text/javascript" src="../static/configurationblock.js"></script>
      <script type="text/javascript">
      $(function(){
          $('.section h1').corner();
          $('.highlight-python pre').corner();
          $('.highlight-yml pre').corner();
          $('.highlight').corner();
      });
      </script>
    <link rel="top" title="Symfony2Doc 1.0.0 documentation" href="../index.html" />
    <link rel="up" title="ガイドブック" href="index.html" />
    <link rel="next" title="パフォーマンス" href="performance.html" />
    <link rel="prev" title="翻訳" href="translation.html" /> 
  </head>
  <body>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/ja_JP/all.js#xfbml=1&appId=47270766548";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div id="all">
  <div id="content">
    <div id="content_wrapper">
      <div id="top_menu">
        <div id="top_menu_wrapper">
        </div>
      </div>
      <div id="header_top">
        <h1 id="logo_top"><a href="http://docs.symfony.gr.jp/">Symfonyユーザー会ドキュメントポータル</a></h1>
        <div id="header_top_left"></div>
      </div>
      <!-- end #header -->
      <div id="navbar">
        <ul>
          <li><a href="../index.html">トップ（索引）</a></li>
          <li><a href="../quick_tour/index.html">クイックツアー</a></li>
          <li><a href="index.html">ガイドブック</a></li>
          <li><a href="../cookbook/index.html">クックブック</a></li>
          <li><a href="../components/index.html">コンポーネント</a></li>
          <li><a href="../reference/index.html">リファレンス</a></li>
          <li><a href="../contributing/index.html">貢献</a></li>
          <li><a href="http://www.symfony.gr.jp/">日本Symfonyユーザー会</a></li>
        </ul>
      </div>
      <!-- end #navbar -->
      <div id="main">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="admonition note" id="index-0">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>対象バージョン：2.3、2.4</li>
<li>翻訳更新日：2013/10/19</li>
</ul>
</div>
<div class="section" id="id1">
<h1>サービスコンテナ<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>一般的にアプリケーションは、さまざまなオブジェクトで構成されています。電子メールメッセージの送信を担当するオブジェクトがあれば、情報のデータベースへの永続化を担当するオブジェクトもあります。アプリケーション内でも、製品の在庫管理を担当するオブジェクトがあれば、外部 API から取得したデータの処理を担当するオブジェクトもあります。アプリケーションには多くの仕事がありますが、個々の仕事はそれを専門で担当する小さなオブジェクトに割り当てられ、それが集まってアプリケーションが構成されているのです。</p>
<p>この章では、Symfony2 のサービスコンテナについて解説します。サービスコンテナは 1 つの PHP オブジェクトであり、アプリケーション内でオブジェクトをインスタンス化、組み立て、取り出すのに利用します。サービスコンテナを使うと、アプリケーションにおけるオブジェクトの生成方法を標準化し、一元化できるようになります。再利用可能で疎結合なコードのためのアーキテクチャを提供しています。Symfony2 のすべてのコアクラスはコンテナを使っているので、Symfony2 の任意のオブジェクトを拡張し、設定して利用する方法もこの章で学べます。サービスコンテナは、Symfony2 のプロダクション環境での実行速度と、コードの拡張性に大きく貢献しています。</p>
<p>サービスコンテナのコンフィギュレーションや利用は難しくありません。本章を最後まで読めば、アプリケーション用に定義したオブジェクトをコンテナ経由でインスタンス化したり、サードパーティのバンドルで提供されるオブジェクトをカスタマイズして利用できるようになります。</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">この章を読み終えた後、さらに詳しく学びたい方は、
<tt class="xref doc docutils literal"><span class="pre">Dependency</span> <span class="pre">Injection</span> <span class="pre">コンポーネント</span></tt>
のドキュメントを参照してください。</p>
</div>
<div class="section" id="index-1">
<span id="id2"></span><h2>サービスとは何か？<a class="headerlink" href="#index-1" title="Permalink to this headline">¶</a></h2>
<p>シンプルに言うと、<em class="xref std std-term">Service</em> (サービス) とは何らかのタスクを実行する PHP オブジェクトです。ある目的 (メール配信など) のために作成されるオブジェクトを指す、コンピュータサイエンスで一般的に使用される用語です。それぞれのサービスは、アプリケーションでその機能が必要になった時点で利用されます。サービスを作成するために特別な作業は必要ありません。目的の仕事を行う PHP クラスのコードを書けば、それがサービスクラスそのものです。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">アプリケーション全体で使われるオブジェクトはサービスです。電子メールメッセージの送信を担当する単一の <tt class="docutils literal"><span class="pre">Mailer</span></tt> サービスはアプリケーション全体で使われますが、送信するそれぞれの <tt class="docutils literal"><span class="pre">Message</span></tt> オブジェクトはサービスでは<em>ありません</em>。同じように、<tt class="docutils literal"><span class="pre">Product</span></tt> オブジェクトもサービスでありません。しかし、<tt class="docutils literal"><span class="pre">Product</span></tt> オブジェクトをデータベースへ永続化するオブジェクトは<em>サービス</em>です。</p>
</div>
<p>サービスの利点は何でしょうか？ サービスを中心に考えると、アプリケーションの機能をサービスに分割して扱えるようになります。各サービスの役割は1つだけで単純にしておき、必要になった時にサービスにアクセスしてその機能を使う、という考え方でアプリケーションを構築できます。個々のサービスはアプリケーションの他の機能から分離されているので、テストしやすく、構成も簡単です。この考え方は<a class="reference external" href="http://ja.wikipedia.org/wiki/サービス指向アーキテクチャ">サービス指向アーキテクチャ</a> と呼ばれ、Symfony2 独自のものではありません。独立したサービスクラスの集合でアプリケーションを構成することは、一般的で信頼性のあるオブジェクト指向設計・プログラミングのベストプラクティスです。</p>
</div>
<div class="section" id="index-2">
<span id="id3"></span><h2>サービスコンテナとは何か？<a class="headerlink" href="#index-2" title="Permalink to this headline">¶</a></h2>
<p><em class="xref std std-term">Service Container</em> (サービスコンテナ) (または <em>依存性注入コンテナ</em>) はサービスのインスタンス化を管理する単純な PHP オブジェクトです。
例えば、電子メールメッセージを配信する単純な PHP クラスを考えてみます。サービスコンテナがない場合、メールを送りたい箇所でオブジェクトを作成するコードを毎回記述しなくてはなりません。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Acme\HelloBundle\Mailer</span><span class="p">;</span>

<span class="nv">$mailer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Mailer</span><span class="p">(</span><span class="s1">&#39;sendmail&#39;</span><span class="p">);</span>
<span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="s1">&#39;ryan@foobar.net&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">);</span>
</pre></div>
</div>
<p>これだけであれば、とても簡単です。この仮の <tt class="docutils literal"><span class="pre">Mailer</span></tt> クラスは、電子メールメッセージの具体的な送信方法 (例えば <tt class="docutils literal"><span class="pre">sendmail</span></tt>、<tt class="docutils literal"><span class="pre">smtp</span></tt> など) をコンストラクタの引数で指定できるようになっています。
しかし、アプリケーションの別の箇所で mailer サービスを使いたい時はどうでしょうか？ <tt class="docutils literal"><span class="pre">Mailer</span></tt> オブジェクトを使う必要があるときに<em>毎回</em> mailer の設定を繰り返すことはしたくありません。<tt class="docutils literal"><span class="pre">Mailer</span></tt> のコンストラクタ引数で指定している <tt class="docutils literal"><span class="pre">transport</span></tt> を <tt class="docutils literal"><span class="pre">sendmail</span></tt> から <tt class="docutils literal"><span class="pre">smtp</span></tt> に変更しなければならないとしたらどうでしょうか？ サービスをインスタンス化している箇所をすべて調べて変更していかなければならないでしょう。</p>
</div>
<div class="section" id="index-3">
<span id="id4"></span><h2>コンテナ中でサービスを生成・構成する<a class="headerlink" href="#index-3" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">Mailer</span></tt> オブジェクトをサービスコンテナで管理すれば問題は解決します。サービスコンテナで管理するには、<tt class="docutils literal"><span class="pre">Mailer</span></tt> オブジェクトの生成方法（コンフィギュレーション）をサービスコンテナに伝える必要があります。YAML、XML、PHP 形式でオブジェクトのコンフィギュレーションを記述できます。</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/config.yml</span>
<span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">my_mailer</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span>        <span class="l-Scalar-Plain">Acme\HelloBundle\Mailer</span>
        <span class="l-Scalar-Plain">arguments</span><span class="p-Indicator">:</span>    <span class="p-Indicator">[</span><span class="nv">sendmail</span><span class="p-Indicator">]</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/config.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;services&gt;</span>
        <span class="nt">&lt;service</span> <span class="na">id=</span><span class="s">&quot;my_mailer&quot;</span> <span class="na">class=</span><span class="s">&quot;Acme\HelloBundle\Mailer&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;argument&gt;</span>sendmail<span class="nt">&lt;/argument&gt;</span>
        <span class="nt">&lt;/service&gt;</span>
    <span class="nt">&lt;/services&gt;</span>
<span class="nt">&lt;/container&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/config.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\DependencyInjection\Definition</span><span class="p">;</span>

<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setDefinition</span><span class="p">(</span><span class="s1">&#39;my_mailer&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Definition</span><span class="p">(</span>
    <span class="s1">&#39;Acme\HelloBundle\Mailer&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;sendmail&#39;</span><span class="p">)</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Symfony2 の初期化時に、アプリケーションコンフィギュレーション(デフォルトでは <tt class="docutils literal"><span class="pre">app/config/config.yml</span></tt>)を使ってサービスコンテナがビルドされます。
実際に読み込まれるファイルは <tt class="docutils literal"><span class="pre">AppKernel::registerContainerConfiguration()</span></tt> メソッドで指定されます。
環境ごとのコンフィギュレーションファイル (<tt class="docutils literal"><span class="pre">dev</span></tt> 環境では <tt class="docutils literal"><span class="pre">config_dev.yml</span></tt>、<tt class="docutils literal"><span class="pre">prod</span></tt> 環境では <tt class="docutils literal"><span class="pre">config_prod.yml</span></tt>) が読み込まれるようになっています。</p>
</div>
<p>これで、サービスコンテナから <tt class="docutils literal"><span class="pre">Acme\HelloBundle\Mailer</span></tt> オブジェクトを利用できるようになりました。
コンテナは、通常の Symfony2 のコントローラから利用可能です。コンテナ中のサービスにアクセスするには、次のようにショートカットメソッドである <tt class="docutils literal"><span class="pre">get()</span></tt> を使います。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">HelloController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">sendEmailAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="nv">$mailer</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;my_mailer&#39;</span><span class="p">);</span>
        <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="s1">&#39;ryan@foobar.net&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>コンテナに対して <tt class="docutils literal"><span class="pre">my_mailer</span></tt> サービスを要求すると、コンテナによりオブジェクトが生成され、返されます。
これは、サービスコンテナを使う利点の 1 つでもあります。
つまり、実際に使う状況になるまで、サービスのオブジェクトが生成されることはありません。
定義したサービスをあるサービスでは利用しない場合、サービスのオブジェクトは作成されません。
これにより、メモリ使用量が低下し、アプリケーションの速度が向上します。
また、サービスの定義が増えたとしても、パフォーマンスにはほとんど影響を与えないことも意味します。
繰り返しますが、使われないサービスは、作成されないのです。</p>
<p>さらに、たとえば <tt class="docutils literal"><span class="pre">Mailer</span></tt> サービスをコンテナから取得する場合、最初の 1 回のみオブジェクトが生成され、それ以降は最初に生成されたのと同じインスタンスが返されます。
ほとんどの状況ではこの振る舞いをそのまま使えば良いのですが、もちろんさまざまなカスタマイズを加えることもできます。
また、同一のサービスオブジェクトを共有するのではなく、サービスの要求ごとに別々のインスタンスを作成するようにも設定できます。
&#8220;<a class="reference internal" href="../cookbook/service_container/scopes.html"><em>スコープの使用方法</em></a>&#8221; で別々のインスタンスを作成する設定方法を学ぶことができます。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">この例では、コントローラーは Symfony のベースコントローラーを継承していてサービスコンテナに直接アクセスすることができます。
だから <tt class="docutils literal"><span class="pre">get</span></tt> メソッドを使いサービスコンテナから <tt class="docutils literal"><span class="pre">my_mailer</span></tt> サービスを取得することができます。
また<a class="reference internal" href="../cookbook/controller/service.html"><em>コントローラーをサービスとして</em></a>定義することもできます。
やや高度な内容で必須のものではないのですが、コントローラーに必要なサービスだけを注入することができます。</p>
</div>
</div>
<div class="section" id="book-service-container-parameters">
<span id="id5"></span><h2>サービスのパラメータ化<a class="headerlink" href="#book-service-container-parameters" title="Permalink to this headline">¶</a></h2>
<p>コンテナによるサービス（たとえばオブジェクト）の作成は直線的に行われます。
サービスの定義にパラメータを使うと、管理しやすく柔軟になります。</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/config.yml</span>
<span class="l-Scalar-Plain">parameters</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">my_mailer.class</span><span class="p-Indicator">:</span>      <span class="l-Scalar-Plain">Acme\HelloBundle\Mailer</span>
    <span class="l-Scalar-Plain">my_mailer.transport</span><span class="p-Indicator">:</span>  <span class="l-Scalar-Plain">sendmail</span>

<span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">my_mailer</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span>        <span class="s">&quot;%my_mailer.class%&quot;</span>
        <span class="l-Scalar-Plain">arguments</span><span class="p-Indicator">:</span>    <span class="p-Indicator">[</span><span class="s">&quot;%my_mailer.transport%&quot;</span><span class="p-Indicator">]</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/config.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;parameters&gt;</span>
        <span class="nt">&lt;parameter</span> <span class="na">key=</span><span class="s">&quot;my_mailer.class&quot;</span><span class="nt">&gt;</span>Acme\HelloBundle\Mailer<span class="nt">&lt;/parameter&gt;</span>
        <span class="nt">&lt;parameter</span> <span class="na">key=</span><span class="s">&quot;my_mailer.transport&quot;</span><span class="nt">&gt;</span>sendmail<span class="nt">&lt;/parameter&gt;</span>
    <span class="nt">&lt;/parameters&gt;</span>

    <span class="nt">&lt;services&gt;</span>
        <span class="nt">&lt;service</span> <span class="na">id=</span><span class="s">&quot;my_mailer&quot;</span> <span class="na">class=</span><span class="s">&quot;%my_mailer.class%&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;argument&gt;</span>%my_mailer.transport%<span class="nt">&lt;/argument&gt;</span>
        <span class="nt">&lt;/service&gt;</span>
    <span class="nt">&lt;/services&gt;</span>
<span class="nt">&lt;/container&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/config.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\DependencyInjection\Definition</span><span class="p">;</span>

<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="s1">&#39;my_mailer.class&#39;</span><span class="p">,</span> <span class="s1">&#39;Acme\HelloBundle\Mailer&#39;</span><span class="p">);</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="s1">&#39;my_mailer.transport&#39;</span><span class="p">,</span> <span class="s1">&#39;sendmail&#39;</span><span class="p">);</span>

<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setDefinition</span><span class="p">(</span><span class="s1">&#39;my_mailer&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Definition</span><span class="p">(</span>
    <span class="s1">&#39;%my_mailer.class%&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;%my_mailer.transport%&#39;</span><span class="p">)</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>結果としては、以前のものと全く同じですが、サービスの定義方法が異なっている点に注意してください。
<tt class="docutils literal"><span class="pre">my_mailer.class</span></tt> と <tt class="docutils literal"><span class="pre">my_mailer.transport</span></tt> をパーセント記号 (<tt class="docutils literal"><span class="pre">%</span></tt>) で囲むと、コンテナは、その名前のパラメータを探します。
コンテナが構築される際、パラメータの値が取得され、その値がサービスの定義に適用されます。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>もし YAML ファイルでパラメーターに <tt class="docutils literal"><span class="pre">&#64;</span></tt> で始まる文字列を使いたい場合(例: とても安全なメールパスワード)
もう一つ <tt class="docutils literal"><span class="pre">&#64;</span></tt> 記号を追加してエスケープする必要があります。(これは YAML フォーマットのみに適用されます)</p>
<div class="last highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/parameters.yml</span>
<span class="l-Scalar-Plain">parameters</span><span class="p-Indicator">:</span>
    <span class="c1"># This will be parsed as string &quot;@securepass&quot;</span>
    <span class="l-Scalar-Plain">mailer_password</span><span class="p-Indicator">:</span> <span class="s">&quot;@@securepass&quot;</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>パラメーターや引数内で文字列の一部にパーセント記号を使っている場合、
もう一つパーセント記号を追加してエスケープしなければなりません</p>
<div class="last highlight-xml"><pre>&lt;argument type="string"&gt;http://symfony.com/?foo=%%s&amp;bar=%%d&lt;/argument&gt;</pre>
</div>
</div>
<p>パラメータを使うと、サービスに対して外から情報を与えることができます。
もちろん、パラメータを使わずに定義したサービスと、動作自体に違いはありません。
ですが、パラメータには次に挙げるようないくつかの利点があります。</p>
<ul class="simple">
<li>サービスのオプションを定義から分離し、<tt class="docutils literal"><span class="pre">parameters</span></tt> という単一のキー配下で管理できる。</li>
<li>複数のサービス定義で同じ値を重複して使っている場合でも、パラメータであれば複数のサービス定義で共有できる。</li>
<li>すぐ後で解説するようにバンドル内でサービスを定義する時、パラメータを使った定義にしておくと、
アプリケーション内でサービスをカスタマイズしやすくなります。</li>
</ul>
<p>パラメータを使うかどうかは、開発者次第です。
クオリティの高いサードパーティのバンドルであれば、コンテナに登録されるサービスの設定変更を容易にするためにパラメータを使っていることでしょう。
ですが、アプリケーション内でのみ使うサービスであれば、パラメータを使った柔軟性が不要な場合もあります。</p>
<div class="section" id="array-parameters">
<h3>配列パラメーター(Array Parameters)<a class="headerlink" href="#array-parameters" title="Permalink to this headline">¶</a></h3>
<p>パラメーターは配列も含むことができます。 <em class="xref std std-ref">component-di-parameters-array</em> を参照して下さい。</p>
</div>
</div>
<div class="section" id="id6">
<h2>別のコンテナコンフィギュレーションリソースをインポートする<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">この節では、サービスコンフィギュレーション・ファイルを<em>リソース</em>と呼びます。
ほとんどのサービスコンフィギュレーションリソースは(YAML、XML、PHP といった)ファイルですが、Symfony2 はとてもフレキシブルなので
(データベースや外部の Web サービスなど)どこからでもコンフィギュレーションを読み込むことができます。</p>
</div>
<p>サービスコンテナは１つのコンフィギュレーションリソース(デフォルトでは <tt class="docutils literal"><span class="pre">app/config/config.yml</span></tt>)を使って組み立てられます。
リソースファイル中から(symfony2 コアやサードパーティバンドルを含む)他の全てのサービスコンフィギュレーションを何らかの方法で読み込まなければなりません。
この方法により、アプリケーション内のサービスをとても柔軟に設定することができます。</p>
<p>外部のサービスコンフィギュレーションを読み込む方法はは２つあります。
1つめは、もっともよく使われる <tt class="docutils literal"><span class="pre">imports</span></tt> ディレクティブを介して行う方法です。
2つめは、コンテナエクステンションを使う方法です。2つめの方法はとても柔軟で、
サードパーティバンドルからサービスコンフィギュレーションを読み込む場合に推奨されています。</p>
<div class="section" id="imports">
<span id="service-container-imports-directive"></span><span id="index-4"></span><h3><tt class="docutils literal"><span class="pre">imports</span></tt> を使ってコンフィギュレーションをインポートする<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h3>
<p>これまで、私たちは <tt class="docutils literal"><span class="pre">my_mailer</span></tt> のサービスコンテナの定義を(<tt class="docutils literal"><span class="pre">app/config/config.yml</span></tt> といった)
アプリケーションコンフィギュレーションファイルに直接記述していました。もちろん、
<tt class="docutils literal"><span class="pre">Mailer</span></tt> クラス自身は <tt class="docutils literal"><span class="pre">AcmeHelloBundle</span></tt> 内に存在しますが、 <tt class="docutils literal"><span class="pre">my_mailer</span></tt> コンテナの定義を</p>
<blockquote>
<div>バンドル内に入れた方がより良いでしょう。</div></blockquote>
<p>初めに <tt class="docutils literal"><span class="pre">my_mailer</span></tt> コンテナ定義を <tt class="docutils literal"><span class="pre">AcmeHelloBundle</span></tt> 内の新しいコンテナリソースファイルに
移しましょう。もし <tt class="docutils literal"><span class="pre">Resources</span></tt> や <tt class="docutils literal"><span class="pre">Resources/config</span></tt> ディレクトリが存在していなければ作成して下さい。</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><pre># src/Acme/HelloBundle/Resources/config/services.yml
parameters:
    my_mailer.class:      Acme\HelloBundle\Mailer
    my_mailer.transport:  sendmail

services:
    my_mailer:
        class:        "%my_mailer.class%"
        arguments:    [%my_mailer.transport%]</pre>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- src/Acme/HelloBundle/Resources/config/services.xml --&gt;</span>
<span class="nt">&lt;parameters&gt;</span>
    <span class="nt">&lt;parameter</span> <span class="na">key=</span><span class="s">&quot;my_mailer.class&quot;</span><span class="nt">&gt;</span>Acme\HelloBundle\Mailer<span class="nt">&lt;/parameter&gt;</span>
    <span class="nt">&lt;parameter</span> <span class="na">key=</span><span class="s">&quot;my_mailer.transport&quot;</span><span class="nt">&gt;</span>sendmail<span class="nt">&lt;/parameter&gt;</span>
<span class="nt">&lt;/parameters&gt;</span>

<span class="nt">&lt;services&gt;</span>
    <span class="nt">&lt;service</span> <span class="na">id=</span><span class="s">&quot;my_mailer&quot;</span> <span class="na">class=</span><span class="s">&quot;%my_mailer.class%&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;argument&gt;</span>%my_mailer.transport%<span class="nt">&lt;/argument&gt;</span>
    <span class="nt">&lt;/service&gt;</span>
<span class="nt">&lt;/services&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Acme/HelloBundle/Resources/config/services.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\DependencyInjection\Definition</span><span class="p">;</span>

<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="s1">&#39;my_mailer.class&#39;</span><span class="p">,</span> <span class="s1">&#39;Acme\HelloBundle\Mailer&#39;</span><span class="p">);</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="s1">&#39;my_mailer.transport&#39;</span><span class="p">,</span> <span class="s1">&#39;sendmail&#39;</span><span class="p">);</span>

<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setDefinition</span><span class="p">(</span><span class="s1">&#39;my_mailer&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Definition</span><span class="p">(</span>
    <span class="s1">&#39;%my_mailer.class%&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;%my_mailer.transport%&#39;</span><span class="p">)</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>定義自体は変わらず配置場所だけが変わっています。もちろんサービスコンテナは新しいリソースファイルの存在を知りません。
ですが <tt class="docutils literal"><span class="pre">imports</span></tt> キーを使うことでリソースファイルを簡単に読み込むことができます。</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/config.yml</span>
<span class="l-Scalar-Plain">imports</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="p-Indicator">{</span> <span class="nv">resource</span><span class="p-Indicator">:</span> <span class="s">&quot;@AcmeHelloBundle/Resources/config/services.yml&quot;</span> <span class="p-Indicator">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/config.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;imports&gt;</span>
        <span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">&quot;@AcmeHelloBundle/Resources/config/services.xml&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/imports&gt;</span>
<span class="nt">&lt;/container&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/config.php</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">import</span><span class="p">(</span><span class="s1">&#39;@AcmeHelloBundle/Resources/config/services.php&#39;</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p><tt class="docutils literal"><span class="pre">imports</span></tt> ディレクティブのおかげで、アプリケーションは任意の場所（通常bundle）にある
サービスコンテナコンフィギュレーションリソースを読み込む事ができます。
<tt class="docutils literal"><span class="pre">リソース</span></tt> の場所は, ファイルの場合、リソースファイルへの絶対パスになります。
特別な <tt class="docutils literal"><span class="pre">&#64;AcmeHello</span></tt> シンタックスは <tt class="docutils literal"><span class="pre">AcmeHelloBundle</span></tt> のディレクトリパスを解決します。
これにより、後から <tt class="docutils literal"><span class="pre">AcmeHelloBundle</span></tt> を異なるディレクトリに変更する場合にも気にせずに
リソースファイルのパスを記述することができます。</p>
</div>
<div class="section" id="service-container-extension-configuration">
<span id="index-5"></span><span id="id7"></span><h3>コンテナエクステンションでコンフィギュレーションをインポートする<a class="headerlink" href="#service-container-extension-configuration" title="Permalink to this headline">¶</a></h3>
<p>Symfony2 で開発するときには、自身で特別に作ったバンドルからコンテナコンフィギュレーションを
インポートするために一般的に <tt class="docutils literal"><span class="pre">imports</span></tt> ディレクティブを使うことでしょう。
Symfony2 のコアバンドルを含むサードパーティ製バンドルのコンテナコンフィギュレーションは、
通常、コンテナエクステンションというアプリケーションを設定するのにより柔軟かつ
簡単な別の仕組みでロードされます。</p>
<p>エクステンションの動作を簡単に説明しておきましょう。
内部的には、これまで見たきたのと同じように各バンドルにサービスが定義されています。
つまり、バンドル内に1つ以上のコンフィギュレーションリソースファイル（普通はXML）があり、
このファイルにバンドルのパラメータやサービスが定義されています。
バンドルのコンフィギュレーションリソースファイルは、アプリケーションコンフィギュレーションから
<tt class="docutils literal"><span class="pre">imports</span></tt> ディレクティブを使って直接インポートするのではく、バンドル内にある
<em>サービスコンテナエクステンション</em>を起動して処理させます。
サービスコンテナエクステンションはバンドル作成者が次の 2 つのことを行うために作るPHPクラスです。</p>
<ul class="simple">
<li>バンドルのサービスを設定するために必要な全てのサービスコンテナリソースをインポートする</li>
<li>バンドルのサービスコンフィギュレーションのフラットなパラメータと相互にやり取りすること無く
バンドルの設定ができるように、セマンティックで簡単な設定を提供する</li>
</ul>
<p>言い換えれば、サービスコンテナエクステンションはあなたに代わってバンドルのサービスを設定します。
あなたがすぐに分かるようにと、エクステンションはバンドルを構成するための賢明で高度なインターフェースを提供します。</p>
<p>例として、Symfony2 のコアフレームワークのバンドルである <tt class="docutils literal"><span class="pre">FrameworkBundle</span></tt> を持ってきました。
アプリケーションコンフィギュレーションにある以下のコードで <tt class="docutils literal"><span class="pre">FrameworkBundle</span></tt> 内の
サービスコンテナエクステンションは起動されます。</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/config.yml</span>
<span class="l-Scalar-Plain">framework</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">secret</span><span class="p-Indicator">:</span>          <span class="l-Scalar-Plain">xxxxxxxxxx</span>
    <span class="l-Scalar-Plain">form</span><span class="p-Indicator">:</span>            <span class="l-Scalar-Plain">true</span>
    <span class="l-Scalar-Plain">csrf_protection</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
    <span class="l-Scalar-Plain">router</span><span class="p-Indicator">:</span>        <span class="p-Indicator">{</span> <span class="nv">resource</span><span class="p-Indicator">:</span> <span class="s">&quot;%kernel.root_dir%/config/routing.yml&quot;</span> <span class="p-Indicator">}</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/config.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:framework=</span><span class="s">&quot;http://symfony.com/schema/dic/symfony&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd</span>
<span class="s">                        http://symfony.com/schema/dic/symfony http://symfony.com/schema/dic/symfony/symfony-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;framework:config</span> <span class="na">secret=</span><span class="s">&quot;xxxxxxxxxx&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;framework:form</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;framework:csrf-protection</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;framework:router</span> <span class="na">resource=</span><span class="s">&quot;%kernel.root_dir%/config/routing.xml&quot;</span> <span class="nt">/&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;/framework&gt;</span>
<span class="nt">&lt;/container&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/config.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;framework&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;secret&#39;</span>          <span class="o">=&gt;</span> <span class="s1">&#39;xxxxxxxxxx&#39;</span><span class="p">,</span>
    <span class="s1">&#39;form&#39;</span>            <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(),</span>
    <span class="s1">&#39;csrf-protection&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(),</span>
    <span class="s1">&#39;router&#39;</span>          <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;resource&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;%kernel.root_dir%/config/routing.php&#39;</span><span class="p">,</span>
    <span class="p">),</span>

    <span class="c1">// ...</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>コンフィギュレーションが解析されると、コンテナは <tt class="docutils literal"><span class="pre">framework</span></tt> コンフィギュレーション
ディレクティブを処理することのできるエクステンションを探します。
見つかったエクステンション（この場合は <tt class="docutils literal"><span class="pre">FrameworkBundle</span></tt> 内にあります）が起動され、
そして <tt class="docutils literal"><span class="pre">FrameworkBundle</span></tt> のサービスコンフィギュレーションは読み込まれます。
もし <tt class="docutils literal"><span class="pre">framework</span></tt> というキーをアプリケーションコンフィギュレーションファイルから完全に削除した場合、
Symfony2 のコアサービスは読み込まれません。
重要なのは「管理できる」という点です。Symfony2 フレームワークにはいかなる魔法も制御できない機能もありません。</p>
<p>もちろん、 <tt class="docutils literal"><span class="pre">FrameworkBundle</span></tt> のサービスコンテナエクステンションを単に有効にして
読み込むだけでなく、簡単にバンドルの動作をカスタマイズできます。
サービスが内部でどのように定義されているか気にすることなく、カスタマイズできます。</p>
<p>この場合は <tt class="docutils literal"><span class="pre">error_handler</span></tt>、<tt class="docutils literal"><span class="pre">csrf_protection</span></tt>、<tt class="docutils literal"><span class="pre">router</span></tt> などがカスタマイズできます。
内部的には <tt class="docutils literal"><span class="pre">FrameworkBundle</span></tt> は、自身の特定のサービスを定義し設定するために、ここで指定されたオプションを使います。
バンドルはサービスコンテナに必要な全ての <tt class="docutils literal"><span class="pre">parameters</span></tt> と <tt class="docutils literal"><span class="pre">services</span></tt> の作成の面倒をみています。
まだ多くの構成を簡単にカスタマイズすることを可能にしながら。
さらに付け加えていうと、多くのサービスコンテナエクステンションはバリデーション機能を備えるほど優秀です。
オプションを忘れていたり、データ型が間違っている場合には知らせてくれます。</p>
<p>バンドルのインストールや設定時には、どのよにうにサービスをインストールし設定すべきか
バンドルのドキュメントを参照してください。コアのバンドルで利用可能なオプションは
<a class="reference internal" href="../reference/index.html"><em>リファレンスガイド</em></a>を参照してください。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">元々は、サービスコンテナは <tt class="docutils literal"><span class="pre">parameters</span></tt>, <tt class="docutils literal"><span class="pre">services</span></tt>, <tt class="docutils literal"><span class="pre">imports</span></tt>
ディレクティブだけを認識します。その他のディレクティブはサービスコンテナ
エクステンションによって扱われます。</p>
</div>
<p>バンドルの設定をユーザーフレンドリーにする方法は、クックブック「<a class="reference internal" href="../cookbook/bundles/extension.html"><em>セマンティックコンフィギュレーションを通してバンドルを設定する方法</em></a>」を参照してください。</p>
</div>
</div>
<div class="section" id="index-6">
<span id="id8"></span><h2>サービスの参照（注入）<a class="headerlink" href="#index-6" title="Permalink to this headline">¶</a></h2>
<p>これまでのところ <tt class="docutils literal"><span class="pre">my_mailer</span></tt> サービスはシンプルでした。 たった 1 つのコンストラクター
引数を受け取る、簡単な設定です。これから学んでいきますが、１つまたはそれ以上の他のサービスに
依存するサービスを作成するときに、コンテナの真の力に気がつくことでしょう。</p>
<p>例として、電子メールメッセージの作成とアドレスのコレクションにメール配信を管理する
のに役立つ、新しいサービス <tt class="docutils literal"><span class="pre">NewsletterManager</span></tt> があるとします。もちろん
<tt class="docutils literal"><span class="pre">my_mailer</span></tt> はメールを配信において既にとても便利なので、 実際に配信する
メッセージをハンドリングするために <tt class="docutils literal"><span class="pre">NewsletterManager</span></tt> の内部で使います。
クラスは次のようになります。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Acme/HelloBundle/Newsletter/NewsletterManager.php</span>
<span class="k">namespace</span> <span class="nx">Acme\HelloBundle\Newsletter</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Acme\HelloBundle\Mailer</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">NewsletterManager</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$mailer</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">Mailer</span> <span class="nv">$mailer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mailer</span> <span class="o">=</span> <span class="nv">$mailer</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>サービスコンテナを使わなくても、コントローラー内で <tt class="docutils literal"><span class="pre">NewsletterManager</span></tt> オブジェクトを生成するのは簡単です。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Acme\HelloBundle\Newsletter\NewsletterManager</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">sendNewsletterAction</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$mailer</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;my_mailer&#39;</span><span class="p">);</span>
    <span class="nv">$newsletter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">NewsletterManager</span><span class="p">(</span><span class="nv">$mailer</span><span class="p">);</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>このアプローチでも機能しますが、後から <tt class="docutils literal"><span class="pre">NewsletterManager</span></tt> に第二、第三のコンストラクター
引数を追加する必要がでてきた場合はどうでしょうか。コードをリファクタリングしたり、
クラスをリネームする場合はどうでしょうか？いずれのケースも <tt class="docutils literal"><span class="pre">NewsletterManager</span></tt>
がインスタンス化されている場所を探し変更する必要があります。もちろん、
サービスコンテナにはこういった状況に対応するためのオプションがあります。</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># src/Acme/HelloBundle/Resources/config/services.yml</span>
<span class="l-Scalar-Plain">parameters</span><span class="p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l-Scalar-Plain">newsletter_manager.class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Acme\HelloBundle\Newsletter\NewsletterManager</span>

<span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">my_mailer</span><span class="p-Indicator">:</span>
        <span class="c1"># ...</span>
    <span class="l-Scalar-Plain">newsletter_manager</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span>     <span class="s">&quot;%newsletter_manager.class%&quot;</span>
        <span class="l-Scalar-Plain">arguments</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="s">&quot;@my_mailer&quot;</span><span class="p-Indicator">]</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><pre>&lt;!-- src/Acme/HelloBundle/Resources/config/services.xml --&gt;
&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;container xmlns="http://symfony.com/schema/dic/services"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd"&gt;

    &lt;parameters&gt;
        &lt;!-- ... --&gt;
        &lt;parameter key="newsletter_manager.class"&gt;Acme\HelloBundle\Newsletter\NewsletterManager&lt;/parameter&gt;
    &lt;/parameters&gt;

    &lt;services&gt;
        &lt;service id="my_mailer" ...&gt;
        &lt;!-- ... --&gt;
        &lt;/service&gt;
        &lt;service id="newsletter_manager" class="%newsletter_manager.class%"&gt;
            &lt;argument type="service" id="my_mailer"/&gt;
        &lt;/service&gt;
    &lt;/services&gt;
&lt;/container&gt;</pre>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Acme/HelloBundle/Resources/config/services.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\DependencyInjection\Definition</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\DependencyInjection\Reference</span><span class="p">;</span>

<span class="c1">// ...</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span>
    <span class="s1">&#39;newsletter_manager.class&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Acme\HelloBundle\Newsletter\NewsletterManager&#39;</span>
<span class="p">);</span>

<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setDefinition</span><span class="p">(</span><span class="s1">&#39;my_mailer&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">);</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setDefinition</span><span class="p">(</span><span class="s1">&#39;newsletter_manager&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Definition</span><span class="p">(</span>
    <span class="s1">&#39;%newsletter_manager.class%&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="k">new</span> <span class="nx">Reference</span><span class="p">(</span><span class="s1">&#39;my_mailer&#39;</span><span class="p">))</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>YAML の場合 <tt class="docutils literal"><span class="pre">&#64;my_mailer</span></tt> シンタックスを使うことでコンテナは <tt class="docutils literal"><span class="pre">my_mailer</span></tt>
と名付けられたサービスを探し、 <tt class="docutils literal"><span class="pre">NewsletterManager</span></tt> のコンストラクターに
オブジェクトを渡します。しかしながらこの場合、指定された <tt class="docutils literal"><span class="pre">my_mailer</span></tt> が存在して
いなければなりません。もし存在していなければ例外が投げられます。
依存を任意のものとして印づけるけこともできます。
この設定については次の節で説明します。</p>
<p>参照を使うことはとても強力な手段であり、依存が明確に定義された独自のサービスクラスを
作ることができます。この例では、<tt class="docutils literal"><span class="pre">newsletter_manager</span></tt> サービスが機能するためには
<tt class="docutils literal"><span class="pre">my_mailer</span></tt> サービスが必要です。サービスコンテナにこの依存を定義する時、
コンテナはオブジェクトのインスタンス作成における全ての仕事を処理します。</p>
<div class="section" id="id9">
<h3>任意の依存性: セッターによる注入<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>コンストラクターで依存性を注入するやり方は、依存しているオブジェクトが利用可能な
状態であることを保証するのに優れた方法です。もしクラスに任意の依存を持たせたいの
であれば、セッターによる注入が良い方法かもしれません。
セッターによる注入とは、コンストラクターを通して行うのではなく、メソッド呼び出し
を用いて依存を注入する方法のことを指します。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">namespace</span> <span class="nx">Acme\HelloBundle\Newsletter</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Acme\HelloBundle\Mailer</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">NewsletterManager</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$mailer</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setMailer</span><span class="p">(</span><span class="nx">Mailer</span> <span class="nv">$mailer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mailer</span> <span class="o">=</span> <span class="nv">$mailer</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>セッターメソッドを用いた依存性注入は少しシンタックスを書き換えます。</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># src/Acme/HelloBundle/Resources/config/services.yml</span>
<span class="l-Scalar-Plain">parameters</span><span class="p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l-Scalar-Plain">newsletter_manager.class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Acme\HelloBundle\Newsletter\NewsletterManager</span>

<span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">my_mailer</span><span class="p-Indicator">:</span>
        <span class="c1"># ...</span>
    <span class="l-Scalar-Plain">newsletter_manager</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span>     <span class="s">&quot;%newsletter_manager.class%&quot;</span>
        <span class="l-Scalar-Plain">calls</span><span class="p-Indicator">:</span>
            <span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">setMailer</span><span class="p-Indicator">,</span> <span class="p-Indicator">[</span><span class="s">&quot;@my_mailer&quot;</span><span class="p-Indicator">]]</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><pre>&lt;!-- src/Acme/HelloBundle/Resources/config/services.xml --&gt;
&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;container xmlns="http://symfony.com/schema/dic/services"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd"&gt;

    &lt;parameters&gt;
        &lt;!-- ... --&gt;
        &lt;parameter key="newsletter_manager.class"&gt;Acme\HelloBundle\Newsletter\NewsletterManager&lt;/parameter&gt;
    &lt;/parameters&gt;

    &lt;services&gt;
        &lt;service id="my_mailer" ...&gt;
        &lt;!-- ... --&gt;
        &lt;/service&gt;
        &lt;service id="newsletter_manager" class="%newsletter_manager.class%"&gt;
            &lt;call method="setMailer"&gt;
                &lt;argument type="service" id="my_mailer" /&gt;
            &lt;/call&gt;
        &lt;/service&gt;
    &lt;/services&gt;
&lt;/container&gt;</pre>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Acme/HelloBundle/Resources/config/services.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\DependencyInjection\Definition</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\DependencyInjection\Reference</span><span class="p">;</span>

<span class="c1">// ...</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span>
    <span class="s1">&#39;newsletter_manager.class&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Acme\HelloBundle\Newsletter\NewsletterManager&#39;</span>
<span class="p">);</span>

<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setDefinition</span><span class="p">(</span><span class="s1">&#39;my_mailer&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">);</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setDefinition</span><span class="p">(</span><span class="s1">&#39;newsletter_manager&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Definition</span><span class="p">(</span>
    <span class="s1">&#39;%newsletter_manager.class%&#39;</span>
<span class="p">))</span><span class="o">-&gt;</span><span class="na">addMethodCall</span><span class="p">(</span><span class="s1">&#39;setMailer&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="k">new</span> <span class="nx">Reference</span><span class="p">(</span><span class="s1">&#39;my_mailer&#39;</span><span class="p">),</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">この節で紹介した方法はコンストラクターによる注入(コンストラクターインジェクション)
セッターによる注入(セッターインジェクション)と呼ばれるものです。Symfony2 のサービス
コンテナはプロパティによる注入(プロパティインジェクション)もサポートしています。</p>
</div>
</div>
<div class="section" id="request">
<h3>Request オブジェクトの注入<a class="headerlink" href="#request" title="Permalink to this headline">¶</a></h3>
<div class="versionadded">
<p><span>New in version 2.4: </span><tt class="docutils literal"><span class="pre">request_stack</span></tt> サービスは Symfony 2.4 から追加されました。</p>
</div>
<p>Symfony2 組み込みのサービスは、どれもほとんど同じように振る舞います。コンテナにより単一のインスタンスが作成され、get時や他のサービスへの注入時には同一のインスタンスが返されます。
標準的な Symfony2 アプリケーションで唯一異なるのが、<tt class="docutils literal"><span class="pre">request</span></tt> サービスです。</p>
<p><tt class="docutils literal"><span class="pre">request</span></tt> をサービスへ注入しようとすると、
<tt class="xref php php-class docutils literal"><span class="pre">Symfony\Component\DependencyInjection\Exception\ScopeWideningInjectionException</span></tt>
例外がスローされます。1つのコンテナインスタンスにおいてサブリクエストが生成されることもあり、コンテナのライフタイム中に <tt class="docutils literal"><span class="pre">request</span></tt> が<strong>変更されうる</strong>からです。</p>
<p>Symfony 2.4 からは、<tt class="docutils literal"><span class="pre">request</span></tt> サービスを注入する代わりに <tt class="docutils literal"><span class="pre">request_stack</span></tt> サービスを注入するようにし、サービスの <tt class="docutils literal"><span class="pre">getCurrentRequest()</span></tt> メソッドを使って Request オブジェクトにアクセスしてください。
以前のバージョンを使っている場合や、この問題について詳しく知りたい場合は、クックブックの記事 <a class="reference internal" href="../cookbook/service_container/scopes.html"><em>スコープの使用方法</em></a> を参照してください。</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">コントローラとして使うサービスの場合は、アクションメソッドの引数として <tt class="docutils literal"><span class="pre">Request</span></tt> オブジェクトが渡されるので、コンテナにより注入する必要はありません。
詳細は <a class="reference internal" href="controller.html#book-controller-request-argument"><em>コントローラー引数としての Request</em></a> を参照してください。</p>
</div>
</div>
</div>
<div class="section" id="id10">
<h2>参照を任意にする<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<p>場合によって、サービスは任意の依存を持っているかもしれません。それはきちんと
サービスが確実に動くことを必須としていないということを意味してます。
上の例では <tt class="docutils literal"><span class="pre">my_mailer</span></tt> は存在していなければなりませんでした。そうでなければ
例外が投げられることでしょう。 <tt class="docutils literal"><span class="pre">newsletter_manager</span></tt> サービスの定義を修正
することでこ参照を任意にすることができます。コンテナは <tt class="docutils literal"><span class="pre">my_mailer</span></tt> サービスが
存在していれば注入し、存在していなければなにもしません。</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># src/Acme/HelloBundle/Resources/config/services.yml</span>
<span class="l-Scalar-Plain">parameters</span><span class="p-Indicator">:</span>
    <span class="c1"># ...</span>

<span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">newsletter_manager</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span>     <span class="s">&quot;%newsletter_manager.class%&quot;</span>
        <span class="l-Scalar-Plain">arguments</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="s">&quot;@?my_mailer&quot;</span><span class="p-Indicator">]</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><pre>&lt;!-- src/Acme/HelloBundle/Resources/config/services.xml --&gt;
&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;container xmlns="http://symfony.com/schema/dic/services"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd"&gt;

    &lt;services&gt;
        &lt;service id="my_mailer" ...&gt;
        &lt;!-- ... --&gt;
        &lt;/service&gt;
        &lt;service id="newsletter_manager" class="%newsletter_manager.class%"&gt;
            &lt;argument type="service" id="my_mailer" on-invalid="ignore" /&gt;
        &lt;/service&gt;
    &lt;/services&gt;
&lt;/container&gt;</pre>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Acme/HelloBundle/Resources/config/services.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\DependencyInjection\Definition</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\DependencyInjection\Reference</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\DependencyInjection\ContainerInterface</span><span class="p">;</span>

<span class="c1">// ...</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span>
    <span class="s1">&#39;newsletter_manager.class&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Acme\HelloBundle\Newsletter\NewsletterManager&#39;</span>
<span class="p">);</span>

<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setDefinition</span><span class="p">(</span><span class="s1">&#39;my_mailer&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">);</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setDefinition</span><span class="p">(</span><span class="s1">&#39;newsletter_manager&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Definition</span><span class="p">(</span>
    <span class="s1">&#39;%newsletter_manager.class%&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="k">new</span> <span class="nx">Reference</span><span class="p">(</span>
            <span class="s1">&#39;my_mailer&#39;</span><span class="p">,</span>
            <span class="nx">ContainerInterface</span><span class="o">::</span><span class="na">IGNORE_ON_INVALID_REFERENCE</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>YAML の場合 <tt class="docutils literal"><span class="pre">&#64;?</span></tt> シンタックスを用いることでコンテナに依存が任意であることを伝えます。
もちろん、任意の依存であることを許容するため <tt class="docutils literal"><span class="pre">NewsletterManager</span></tt> は書き直さなければ
なりません。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">Mailer</span> <span class="nv">$mailer</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="symfony">
<h2>Symfony コアバンドルとサードパーティバンドルのサービス<a class="headerlink" href="#symfony" title="Permalink to this headline">¶</a></h2>
<p>Symfony2 や全てのサードパーティ製のバンドルは設定されコンテナ経由でサービスを
取得できるので、それらに簡単にアクセスすることができ自分のサービス内でそれらを
利用することもできます。物事をシンプルに保つために、Symfony2 はデフォルトで
コントローラーをサービスとして定義することを必須としていません。さらに、
Symfony2 Standard Edition のデフォルト構成では、サービスコンテナ全体がコントローラーに注入されます。
例として、ユーザーセッション上に情報を保管する方法をとり上げます。
Symfony2 は <tt class="docutils literal"><span class="pre">session</span></tt> サービスを提供していて、コントローラーから次のようにアスセスすることができます。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">public</span> <span class="k">function</span> <span class="nf">indexAction</span><span class="p">(</span><span class="nv">$bar</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$session</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;session&#39;</span><span class="p">);</span>
    <span class="nv">$session</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="nv">$bar</span><span class="p">);</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Symfony2 では、Symfony コアやサードパーティバンドルに提供された、テンプレートの
レンダリング (<tt class="docutils literal"><span class="pre">templating</span></tt>)、メール送信 (<tt class="docutils literal"><span class="pre">mailer</span></tt>)、 リクエスト情報へのアクセス
(<tt class="docutils literal"><span class="pre">request</span></tt>)といった各タスクを実行するためのサービスを何度も使うことでしょう。</p>
<p>さらにもうワンステップとして、自身のアプリケーション向けに作ったサービス内で
使うこともできます。
まず始めに、<tt class="docutils literal"><span class="pre">NewsletterManager</span></tt> を修正して、Symfony2の本当の <tt class="docutils literal"><span class="pre">mailer</span></tt> サービスを(架空の
<tt class="docutils literal"><span class="pre">my_mailer</span></tt> サービスの代わりに)そのまま使うようにしました。
また、テンプレートを通してメールの文章を作成できるように <tt class="docutils literal"><span class="pre">NewsletterManager</span></tt>
にテンプレートエンジンサービスを渡すようにしました。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">namespace</span> <span class="nx">Acme\HelloBundle\Newsletter</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Templating\EngineInterface</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">NewsletterManager</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$mailer</span><span class="p">;</span>

    <span class="k">protected</span> <span class="nv">$templating</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span>
        <span class="nx">\Swift_Mailer</span> <span class="nv">$mailer</span><span class="p">,</span>
        <span class="nx">EngineInterface</span> <span class="nv">$templating</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mailer</span> <span class="o">=</span> <span class="nv">$mailer</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">templating</span> <span class="o">=</span> <span class="nv">$templating</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>サービスコンテナの設定は簡単です。</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">newsletter_manager</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span>     <span class="s">&quot;%newsletter_manager.class%&quot;</span>
        <span class="l-Scalar-Plain">arguments</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="s">&quot;@mailer&quot;</span><span class="p-Indicator">,</span> <span class="s">&quot;@templating&quot;</span><span class="p-Indicator">]</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;service</span> <span class="na">id=</span><span class="s">&quot;newsletter_manager&quot;</span> <span class="na">class=</span><span class="s">&quot;%newsletter_manager.class%&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;argument</span> <span class="na">type=</span><span class="s">&quot;service&quot;</span> <span class="na">id=</span><span class="s">&quot;mailer&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;argument</span> <span class="na">type=</span><span class="s">&quot;service&quot;</span> <span class="na">id=</span><span class="s">&quot;templating&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/service&gt;</span>
<span class="nt">&lt;/container&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setDefinition</span><span class="p">(</span><span class="s1">&#39;newsletter_manager&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Definition</span><span class="p">(</span>
    <span class="s1">&#39;%newsletter_manager.class%&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="k">new</span> <span class="nx">Reference</span><span class="p">(</span><span class="s1">&#39;mailer&#39;</span><span class="p">),</span>
        <span class="k">new</span> <span class="nx">Reference</span><span class="p">(</span><span class="s1">&#39;templating&#39;</span><span class="p">),</span>
    <span class="p">)</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p><tt class="docutils literal"><span class="pre">newsletter_manager</span></tt> サービスはコアの <tt class="docutils literal"><span class="pre">mailer</span></tt> と <tt class="docutils literal"><span class="pre">templating</span></tt> サービスを
利用できるようになりました。 これはフレームワーク内にある異なるサービスの力を活用し
アプリケーションに固有のサービスを作成するための一般的な方法です。</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">アプリケーションの設定に <tt class="docutils literal"><span class="pre">swiftmailer</span></tt> の登録に表示されていることを確認してください。
<a class="reference internal" href="#service-container-extension-configuration"><em>コンテナエクステンションでコンフィギュレーションをインポートする</em></a> で述べられていますが、<tt class="docutils literal"><span class="pre">swiftmailer</span></tt> キーは
<tt class="docutils literal"><span class="pre">SwiftmailerBundle</span></tt> からサービスエクステンションを呼び出し、 <tt class="docutils literal"><span class="pre">mailer</span></tt> サービスを登録します。</p>
</div>
<div class="section" id="tags">
<span id="book-service-container-tags"></span><h3>タグ (<tt class="docutils literal"><span class="pre">tags</span></tt>)<a class="headerlink" href="#tags" title="Permalink to this headline">¶</a></h3>
<p>Web のブログ記事に「Symfony」や「PHP」とタグ付けするのと同じで、コンテナに設定された
サービスにもタグをつけることができます。サービスコンテナにおいて、タグは
そのサービスが特定の目的のために使われることを表します。</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">foo.twig.extension</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Acme\HelloBundle\Extension\FooExtension</span>
        <span class="l-Scalar-Plain">tags</span><span class="p-Indicator">:</span>
            <span class="p-Indicator">-</span>  <span class="p-Indicator">{</span> <span class="nv">name</span><span class="p-Indicator">:</span> <span class="nv">twig.extension</span> <span class="p-Indicator">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;service</span> <span class="na">id=</span><span class="s">&quot;foo.twig.extension&quot;</span>
        <span class="na">class=</span><span class="s">&quot;Acme\HelloBundle\Extension\FooExtension&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tag</span> <span class="na">name=</span><span class="s">&quot;twig.extension&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/service&gt;</span>
<span class="nt">&lt;/container&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="nv">$definition</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Definition</span><span class="p">(</span><span class="s1">&#39;Acme\HelloBundle\Extension\FooExtension&#39;</span><span class="p">);</span>
<span class="nv">$definition</span><span class="o">-&gt;</span><span class="na">addTag</span><span class="p">(</span><span class="s1">&#39;twig.extension&#39;</span><span class="p">);</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setDefinition</span><span class="p">(</span><span class="s1">&#39;foo.twig.extension&#39;</span><span class="p">,</span> <span class="nv">$definition</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p><tt class="docutils literal"><span class="pre">twig.extension</span></tt> タグは <tt class="docutils literal"><span class="pre">TwigBundle</span></tt> がコンフィギュレーション中に使う特別なタグです。
サービスに <tt class="docutils literal"><span class="pre">twig.extension</span></tt> タグをつけることでバンドル(TwigBundle)は
<tt class="docutils literal"><span class="pre">foo.twig.extension</span></tt> サービスが、Twig の Twig エクステンションとして登録されるべきだ
ということを知ります。言い換えると、Twig は <tt class="docutils literal"><span class="pre">twig.extension</span></tt> でタグ付けされた全ての
サービスを探し、それら全てを自動的に Twig エクステンションとして追加します。</p>
<p>それゆえ、タグは自身のサービスを登録したり、またはバンドルによって特別な方法で
使われるよう、Symfony2 やサードパーティ製のバンドルに指示する方法です。</p>
<p>以下は Symfony2 のコアバンドルで利用可能なタグの一覧です。これらのタグは各々
サービスに対して異なる効果があり、多くのタグは追加の引数
(単なる <tt class="docutils literal"><span class="pre">name</span></tt> パラメーター以上のもの)を必要とします。</p>
<p>Symfony2 のコアフレームワークで利用可能な全てのタグの一覧については
<a class="reference internal" href="../reference/dic_tags.html"><em>Dependency Injectionタグ</em></a> を参照してください。</p>
</div>
</div>
<div class="section" id="id11">
<h2>サービスのデバッグ<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<p>コンソールを使うことで、コンテナにどんなサービスが登録されているか見ることができます。
次のコマンドを実行することで全てのサービスとそのクラスが表示されます。</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>php app/console container:debug
</pre></div>
</div>
<p>デフォルトでは public なサービスが表示されます。次のように &#8211;show-private オプション
をつければ private なサービスも表示させることができます。</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>php app/console container:debug --show-private
</pre></div>
</div>
<p>また特定のサービスIDを指定することで、そのサービスについてより詳細な情報を得ることができます。</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>php app/console container:debug my_mailer
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h2>もっと学ぶ<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><tt class="xref doc docutils literal"><span class="pre">/components/dependency_injection/parameters</span></tt></li>
<li><tt class="xref doc docutils literal"><span class="pre">/components/dependency_injection/compilation</span></tt></li>
<li><tt class="xref doc docutils literal"><span class="pre">/components/dependency_injection/definitions</span></tt></li>
<li><tt class="xref doc docutils literal"><span class="pre">/components/dependency_injection/factories</span></tt></li>
<li><tt class="xref doc docutils literal"><span class="pre">/components/dependency_injection/parentservices</span></tt></li>
<li><tt class="xref doc docutils literal"><span class="pre">/components/dependency_injection/tags</span></tt></li>
<li><a class="reference internal" href="../cookbook/controller/service.html"><em>コントローラをサービスとして定義する方法</em></a></li>
<li><a class="reference internal" href="../cookbook/service_container/scopes.html"><em>スコープの使用方法</em></a></li>
<li><tt class="xref doc docutils literal"><span class="pre">/cookbook/service_container/compiler_passes</span></tt></li>
<li><tt class="xref doc docutils literal"><span class="pre">/components/dependency_injection/advanced</span></tt></li>
</ul>
</div>
</div>


<div id="page_prev_next">
<a class="prev" href="translation.html">< 翻訳</a>
<a class="next" href="performance.html">パフォーマンス ></a>
</div>

<div class="common_content_footer">
<ul>
  <li> → <a href="http://symfony.com/doc/master/book/service_container.html">公式英語ドキュメント</a></li>
  <li> → <a href="https://github.com/symfony/symfony-docs/commits/master/book/service_container.rst">原文コミット履歴</a>
  <li> → <a href="https://github.com/symfony-japan/symfony-docs-ja/commits/master/book/service_container.rst">翻訳コミット履歴</a>
</ul>
<br />
翻訳の不備などは、お気軽にコメント欄にてご指摘ください。
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'symfony-japan'; // required: replace example with your forum shortname

    // The following are highly recommended additional parameters. Remove the slashes in front to use.
    // var disqus_identifier = 'unique_dynamic_id_1234';
    // var disqus_url = 'http://example.com/permalink-to-page.html';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>



          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div class="fb-like-box" data-href="http://www.facebook.com/symfonyjapan" data-width="203" data-show-faces="true" data-stream="true" data-border-color="#FFF" data-header="true"></div>
  <h3>このページのコンテンツ</h3>
  <ul>
<li><a class="reference internal" href="#">サービスコンテナ</a><ul>
<li><a class="reference internal" href="#index-1">サービスとは何か？</a></li>
<li><a class="reference internal" href="#index-2">サービスコンテナとは何か？</a></li>
<li><a class="reference internal" href="#index-3">コンテナ中でサービスを生成・構成する</a></li>
<li><a class="reference internal" href="#book-service-container-parameters">サービスのパラメータ化</a><ul>
<li><a class="reference internal" href="#array-parameters">配列パラメーター(Array Parameters)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id6">別のコンテナコンフィギュレーションリソースをインポートする</a><ul>
<li><a class="reference internal" href="#imports"><tt class="docutils literal"><span class="pre">imports</span></tt> を使ってコンフィギュレーションをインポートする</a></li>
<li><a class="reference internal" href="#service-container-extension-configuration">コンテナエクステンションでコンフィギュレーションをインポートする</a></li>
</ul>
</li>
<li><a class="reference internal" href="#index-6">サービスの参照（注入）</a><ul>
<li><a class="reference internal" href="#id9">任意の依存性: セッターによる注入</a></li>
<li><a class="reference internal" href="#request">Request オブジェクトの注入</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id10">参照を任意にする</a></li>
<li><a class="reference internal" href="#symfony">Symfony コアバンドルとサードパーティバンドルのサービス</a><ul>
<li><a class="reference internal" href="#tags">タグ (<tt class="docutils literal"><span class="pre">tags</span></tt>)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id11">サービスのデバッグ</a></li>
<li><a class="reference internal" href="#id12">もっと学ぶ</a></li>
</ul>
</li>
</ul>

  <h4>前のドキュメント</h4>
  <p class="topless"><a href="translation.html"
                        title="previous chapter">翻訳</a></p>
  <h4>次のドキュメント</h4>
  <p class="topless"><a href="performance.html"
                        title="next chapter">パフォーマンス</a></p>
  <h3>ソース</h3>
  <ul class="this-page-menu">
    <li><a href="../sources/book/service_container.txt"
           rel="nofollow">ページのソースを表示</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>クイック検索</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
          <br />
          <br />
          <div id="other">
            <h3>クイックリンク</h3>
            <ul>
              <li><a href="installation.html">インストール方法</a></li>
              <li><a href="../reference/forms/types.html">FormTypeリファレンス</a></li>
              <li><a href="../reference/constraints.html">バリデータリファレンス</a></li>
              <li><a href="http://twig.sensiolabs.org/documentation">Twigリファレンス</a></li>
              <li><a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/annotations-reference.html">Doctrine ORMアノテーションリファレンス</a></li>
            </ul>

            <h3>コメントリスト</h3>

<script type="text/javascript" src="http://symfony-japan.disqus.com/combination_widget.js?num_items=10&hide_mods=0&color=grey&default_tab=recent&excerpt_length=200"></script><a href="http://disqus.com/">Powered by Disqus</a>


            <br />
            <p>ご質問や翻訳不備等お気軽にコメントください。</p>

            <br />
            <p>現在、翻訳が古くなっている箇所が多くあります。1箇所、1行などほんの少量でもかまいませんので、ドキュメント翻訳にご協力いただける方を募集しています。<a href="http://groups.google.com/group/symfony-users-ja">日本 Symfony ユーザー会メーリングリスト</a>までご連絡ください。</p>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

      </div>
      <!-- end #main -->
    </div>
    <!-- end #content_wrapper -->
  </div>
  <!-- end #content -->


  <div id="footer">
    <div id="footer_wrapper">
      <div id="footer_content">
        <div style=" position: relative;">
          <div id="footer_left"></div>
          <div id="footer_right"></div>
        </div>
        <div id="f_navbar">
        <ul>
          <li><a href="../index.html">トップ（索引）</a></li>
          <li><a href="../quick_tour/index.html">クイックツアー</a></li>
          <li><a href="index.html">ガイドブック</a></li>
          <li><a href="../cookbook/index.html">クックブック</a></li>
          <li><a href="../components/index.html">コンポーネント</a></li>
          <li><a href="../reference/index.html">リファレンス</a></li>
          <li><a href="../contributing/index.html">貢献</a></li>
          <li><a href="http://www.symfony.gr.jp/">日本Symfonyユーザー会</a></li>
        </ul>
      </div>
      <!-- end #navbar -->
        <div>
          <p id="copyright">
            Copyright &copy; 2011-2013 Symfony Japan. All rights reserved.
            &nbsp;&nbsp;&nbsp;Bandwidth and hardware provided by <a href="http://www.asial.co.jp/">アシアル株式会社</a>
            &nbsp;&nbsp;Powered by <a href="http://sphinx.pocoo.org/">Sphinx</a>
          </p>
        </div>
      </div>
      <!-- end #footer_content -->
        </div>
        <!-- end #footer_wrapper -->
      </div>
      <!-- end #footer -->
    </div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-16659283-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
  </body>
</html>
